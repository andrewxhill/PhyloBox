<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <title>PhyloBox</title>
    <style type="text/css" media="screen">@import "/static/javascript/jqtouch/jqtouch.min.css";</style> 
    <style type="text/css" media="screen">@import "/static/javascript/jqtouch/themes/jqt/theme.min.css";</style> 

    <script src="/static/javascript/jqtouch/jquery.1.3.2.min.js" type="text/javascript" charset="utf-8"></script> 
    <script src="/static/javascript/jqtouch/jqtouch.min.js" type="application/x-javascript" charset="utf-8"></script> 
        
    <script type="text/javascript">
        var jQT = new $.jQTouch({
        icon: '/static/images/jqtouch/themes/jqtouch.png',
        addGlossToIcon: false,
        startupScreen: '/static/images/jqtouch/themes/jqt_startup.png',
        statusBar: 'black',
        preloadImages: [
            '/static/javascript/jqtouch/themes/jqt/img/back_button.png',
            '/static/javascript/jqtouch/themes/jqt/img/back_button_clicked.png',
            '/static/javascript/jqtouch/themes/jqt/img/button_clicked.png',
            '/static/javascript/jqtouch/themes/jqt/img/grayButton.png',
            '/static/javascript/jqtouch/themes/jqt/img/whiteButton.png',
            '/static/javascript/jqtouch/themes/jqt/img/loading.gif'
            ]
        });
        $(document).ready(function(){
            var width = $(this).width();    // Current image width
            var height = $(this).height();  // Current image height
            //$('#previewPNG').css('height',height);
            $('.previewPNG').css('max-width',width);
            //Orientation Changes
            $(function(){
                $('body').bind('turn', function(event, info){
                      console.log(info.orientation); // landscape or profile
                });
            });
            
            $(".linkPNG").each(function(){
                var html = $(this).attr('id');
                var img = $(document.createElement('img'));
                $(img).css('max-width',width);
                $(img).css('border','0px');
                $(img).attr("class","previewPNG");
                $(img).attr('src',html);
                $(this).html("");
                $(this).append($(img));
            });
            
            //make sure the text fits in the space
            
            
            $(".arrow").each(function(){
                var maxWidth = Math.floor(1*$(document).width()/5)-4;
                var counter = $(this).children(".counter");
                var textWidth = $(counter).width();
                if (textWidth > maxWidth){
                    var fontSize = 18;
                    do {
                        $(counter).css('font-size', fontSize);
                        //$(this).css({'white-space':'normal','word-wrap':'break-word','height':'100%','max-width':maxWidth+"px"});
                        textWidth = $(counter).width();
                        fontSize = fontSize - 1;
                    } while (textWidth > maxWidth && fontSize > 3); 
                }
            
                maxWidth = (4*Math.floor($(document).width()/5))-$(counter).width()-4;
                
                var linklist = $(this).find(".list_link");
                textWidth = $(linklist).width();
                if (textWidth > maxWidth){
                    fontSize = 18;
                    do {
                        $(linklist).css('font-size', fontSize);
                        $(linklist).css({'white-space':'normal','word-wrap':'break-word','height':'100%','max-width':maxWidth+"px"});
                        textWidth = $(linklist).width();
                        fontSize = fontSize - 1;
                    } while (textWidth > maxWidth && fontSize > 3); 
                }
            });
        });
    </script>
    <style type="text/css" media="screen"> 
    </style>
</head>
<body>
<div id="home"> 
    <div class="toolbar"> 
        <h1>PhyloBox</h1> 
        <a class="button slideup" href="#preview-1">Preview</a> 
    </div> 
    <ul class="rounded"> 
    {% for row in rows %}
        <li class="arrow">
            <a class="project_link" href="/mobile/fullscreen?k={{row.treeId}}" target="_blank"><span class="list_link">{{ row.title }}</span> </a> <small class="counter">{{ row.author }} </small>
        </li>
    {% endfor %}
    </ul>
</div>
{% for row in rows %}
<div id="preview-{{ row.rowCt }}">
    <div id="toolbar-{{ row.rowCt }}" class="toolbar"> 
        <h1>PhyloBox</h1> 
        <a class="button slidedown" href="#list">List</a> 
    </div> 
    <p>{{row.rowCt}}. {{row.title}}: {{row.last_update_date}}</p>
    <p><a class="linkPNG" href="/mobile/fullscreen?k={{row.treeId}}" id="/api/image.png?k={{row.treeId}}">Loading...</a></p> 
    <ul class="individual"> 
        <li><a class="last" href="#preview-{{ row.lastRow }}">Last</a></li> 
        <li><a class="next" href="#preview-{{ row.nextRow }}">Next</a></li> 
    </ul> 
</div>
{% endfor %}

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-4047687-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
